<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="main.css" type="text/css" />
<link rel="stylesheet" href="blog.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="Subscribe to this page..." href="feed.rss" />
<title>Init Provisioning</title>
</head><body>
<div id="divbodyholder">
<div class="headerholder"><div class="header">
<div id="title">
<h1 class="nomargin"><a class="ablack" href="http://matt-at.keyboard-writes-code.com//index.html">Matt at Keyboard Writes Code</a></h1>
<div id="description">A blog about software development, technology and other things that interest me</div>
</div></div></div>
<div id="divbody"><div class="content">
<!-- entry begin -->
<h3><a class="ablack" href="2015-03-28-init-provisioning.html">
Init Provisioning
</a></h3>
<!-- bashblog_timestamp: #201503280830.01# -->
<div class="subtitle">March 28, 2015 &mdash; 
Matt Forrester
</div>
<!-- text begin -->
<p>I have a desire set up virtual machines on my laptop using scripts for testing things like microservices. Unfortunately I don't much like BASH as a provisioning system and would prefer to work with <a href="http://www.ansible.com/home">Ansible</a>.</p>
<p>The Init Provisioning scripts are designed to allow easy development of Ansible based virtual machines they perform the following tasks.</p>
<ul>
<li>Copy your SSH config and keys from <code>~/.ssh/</code> into the virtual machine for authentication with GitHub etc.</li>
<li>Install libraries necessary to install Ansible using <a href="http://en.wikipedia.org/wiki/Pip_%28package_manager%29">pip</a></li>
<li>Install Ansible.</li>
<li>Set up the <code>/etc/ansible/hosts</code> file with roles coming from an environmental variable.</li>
<li>Run <code>ansible-pull</code> on repositories and playbooks which are also configured from environmental variables.</li>
</ul>
<p>The following environmental variables are used:</p>
<blockquote>
<p><code>ROLES</code>: This is a semi colon separated list of all the roles you wish to give the virtual machine. These will be stored in <code>/etc/ansible/hosts</code></p>
<p><code>ANSIBLE_PULL_REPOSITORY_PLAYBOOK</code>: This is a more complicated environmental variable consisting of:</p>
<ul>
<li>A Git repository</li>
<li>Followed by two colons</li>
<li>Then a set of playbook names (without the .yml extension) which should be separated by commas.</li>
<li>If there are any more Git repositories, a semi colon should be inserted followed by another Git repository etc.</li>
</ul>
</blockquote>
<p>The end result is a command line which looks something like the following:</p>
<pre><code>ANSIBLE_PULL_REPOSITORY_PLAYBOOK='git@github.com:forbesmyester/provisioning-common.git::terminal_developer,gui_developer;git@github.com:someother/repository::another_playbook' ROLES=developer vagrant up
</code></pre>
<p>And if your playbooks are correct, a completely provisioned and working Vagrant virtual machine.</p>
<p>You can get the <a href="https://github.com/forbesmyester/init-provisioning">Project at GitHub</a>.</p>




<!-- text end -->
<!-- entry end -->
</div>
<div id="footer">All rights reserved <a href="http://matt-at.keyboard-writes-code.com/me.html">Matt Forrester</a> &mdash; <a href="mailto:matt&#64;keyboardwritescode&#46;com">matt&#64;keyboardwritescode&#46;com</a><br/>
Generated with <a href="https://github.com/cfenollosa/bashblog">bashblog</a>, a single bash script to easily create blogs like this one</div>
</div></div>
</body></html>
